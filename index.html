<!DOCTYPE html>
<html>
<head>
    <title>run deep</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    background-color: black;
    position: absolute;
    top: 135px;
    left: 340px;
    }
    body{
        margin: 0;
        background: black;
    }
</style>
</head>
<body onload="start()">
    
    <audio id="dead">
    <source src="dead.mp3" type="audio/mpeg">
    </audio>
    
    
<script>
var deep;
var obs = [];
var level=1;
    var score=0;
function start() {
    deep = new gamecomponent(15, 15, "yellow", 20, 185,1,0);
    gamearea.start();
     
}

var gamearea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 620; 
        this.canvas.height = 370; 
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo  = 0;
        this.interval = setInterval(updateGameArea, 17);
        window.addEventListener('mousemove', function (e) {
            if(e.pageX>350 && e.pageX<955 && e.pageY>150 && e.pageY<490){
            gamearea.x = e.pageX-340;
            gamearea.y = e.pageY-135;}
        })
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }    
}
function gameborder(){
        ctx = gamearea.context;
        ctx.strokeStyle = "#EE3F7A";
        ctx.lineWidth=10;
        ctx.strokeRect(0,0 ,620 ,370 );
}
//function sound(src) {
//    this.sound = document.createElement("audio");
//    this.sound.src = src;
//    this.sound.setAttribute("preload", "auto");
//    this.sound.setAttribute("controls", "none");
//    this.sound.style.display = "none";
//    document.body.appendChild(this.sound);
//    this.play = function(){
//        this.sound.play();
//    }
//    this.stop = function(){
//        this.sound.load();
//    }    
//}
function gamecomponent(width, height, color, x, y,z,m) {
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;    
    this.z = z;
    this.m=m;
    this.update = function() {
        ctx = gamearea.context;
        if(this.z==1)
        {ctx.beginPath();ctx.arc(this.x,this.y,(this.width), 0, 2*Math.PI); ctx.fillStyle=color; ctx.fill(); }
        else{
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);}
    }
    
    this.crashWith = function(otherobj) {
        var x1=otherobj.x;
        var x2=otherobj.x + (otherobj.width);
        var y1=otherobj.y;
        var y2= otherobj.y + (otherobj.height);
        var crash = true;;
        
        if(otherobj.z !=1){
        var d1=x1-this.x;
        var d2=this.y-y2;
        var d3=this.x-x2;
        var d4=y1-this.y;
        if(d1>15 || d2>15 || d3>15 || d4>15){crash=false;}
        }
     else{   
        var d=(this.x - x1)*(this.x - x1) + (this.y - y1)*(this.y - y1);
        if(d >=3025){crash=false;}}
        
        return crash;
    }
}
 var h;
    var u=25;
function updateGameArea() {
    var x, y;
    gamearea.clear();
    gamearea.frameNo += 0.0625;
    score = (gamearea.frameNo - 0.0625) + level*2;
    if( (score ==100) ||  (score==300) )
        {level = level +1;}
    if(score > 350 && score%100 ==0){level = level + 1;}
    if (gamearea.x && gamearea.y) {
        deep.x = gamearea.x;
        deep.y = gamearea.y;        
    }
    if (gamearea.frameNo == 1 || everyinterval(9.375)) {
         y = (150)*Math.random() +10;
         h= 105 + Math.floor(80*Math.random());
         var g=10*Math.random();
         var p= 10*Math.random() -5;
           p= p/(Math.abs(p));
        if(g>7){g=11;}
         if(g!=11 || level==1){obs.push(new gamecomponent(25, h, "#EE3F7A", 620, y,0,1*p));}
        else if(g=11 && level>=2) {obs.push(new gamecomponent(40, 40, "#EE3F7A", 660, Math.floor(220*Math.random())+55,1,2*p));
             }
    }
    for (i = 0; i < obs.length; i += 1) {
        obs[i].x += -1;
         if(obs[i].z==1 && (obs[i].y>=321 || obs[i].y<=49) ){obs[i].m=obs[i].m*(-1);}
         if(obs[i].z==1 ){obs[i].y +=obs[i].m; }//obs[i].x += -(Math.abs(obs[i].m)) +1;
        if(level>=3){
        if(obs[i].z!=1 && (obs[i].y + obs[i].height >370 || obs[i].y<10) ){obs[i].m=obs[i].m*(-1);}
        if(obs[i].z!=1 ){obs[i].y += obs[i].m; }
        }
        obs[i].update();
    }
    document.getElementById("score").innerHTML="Score "+ Math.floor(score);
    deep.update();
    gameborder();
     for (i = 0; i < obs.length; i += 1) {
        if (deep.crashWith(obs[i])) {
//            console.log("1");
            gamearea.stop();
            var c= document.getElementById("dead");
            c.play();
            document.getElementById("restart").style.display="block";
            h=setInterval(deepfall,4);
            return;        
        }
    }
}
function deepfall(){
    deep.y +=1.5;
    document.getElementById("score").innerHTML="G A M E &nbsp; O V E R!"+"<br>"+"&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;"+"Score "+ Math.floor(score);
    gamearea.clear();
    for (i = 0; i < obs.length; i += 1) {
        obs[i].update();
    }
    gameborder();
    deep.update();
    if(deep.y>=500)
        {
            clearInterval(h);
        }
}
    
function everyinterval(n) {
    if ((gamearea.frameNo / n) % 1 == 0) {return true;}
    else {return false;}
}

</script>
<button id="restart" style="color: yellow;font-size: 2em;border: 0; background: black;position: absolute;top: 88%;left: 45%;display: none;"onClick="document.location.reload()">RESTART</button>
<div id="score" style="color: dodgerblue;border: yellow;font-size: 2.1em;font-weight: bold;position: absolute;left: 76%;top: 10%;">Score 0</div>
</body>
</html>
